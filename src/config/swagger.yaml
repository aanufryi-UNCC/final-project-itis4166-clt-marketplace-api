openapi: 3.0.0
info:
  title: CLT Marketplace API
  version: "1.0.0"

servers:
  - url: https://clt-marketplace-api.onrender.com
    description: Render server
  - url: http://localhost:3000

tags:
  - name: Auth
    description: Authentication endpoints
  - name: Categories
    description: Category managment endpoints
  - name: Items
    description: Item listing and managementn endpoints
  - name: Orders
    description: Order creation,searching and status updates
  - name: Reviews
    description: Create item reviews and managment
  - name: Users
    description: User profile and role managment 

paths:
  /api/auth/register:
    post:
      summary: Create a new user account
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
              properties:
                username:
                  type: string
                  example: user123
                email:
                  type: string
                  example: uncc@example.com
                password:
                  type: string
                  example: Password123!
      responses:
        "201":
          description: User account has been created.
        "400":
          description: Validation failed, email could already be in use.

  /api/auth/login:
    post:
      summary: Login and receive an access token
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  example: uncc@example.com
                password:
                  type: string
                  example: Password123
      responses:
        "200":
          description: Login was successful.
        "401":
          description: Invalid login information.

  /api/categories/categories:
    get:
      summary: Get all categories
      description: Returns a list of all item categories in the marketplace.
      tags:
        - Categories
      responses:
        "200":
          description: A list of categories.
    post:
      summary: Create a new category
      description: Creates a new category(only mods can access this)
      tags:
        - Categories
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: Electronics
                description:
                  type: string
                  example: Devices and gadgets such as phones, tablets, and laptops.
      responses:
        "201":
          description: Category created successfully.
        "400":
          description: Invalid category data.
        "401":
          description: Missing or invalid authentication token.
        "403":
          description: User is not authorized to create categories.

  /api/categories/categories/{id}:
    get:
      summary: Get a category by ID
      description: Fetch a single category by its unique ID.
      tags:
        - Categories
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the category to retrieve.
      responses:
        "200":
          description: Category found.
        "400":
          description: Invalid category ID.
        "404":
          description: Category not found.
    patch:
      summary: Update a category
      description: Updates a category's information.(only for mods)
      tags:
        - Categories
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the category to update.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: Home Appliances
                description:
                  type: string
                  example: Appliances and tools used in the home.
      responses:
        "200":
          description: Category updated successfully.
        "400":
          description: Invalid request data or category ID.
        "401":
          description: Missing or invalid authentication token.
        "403":
          description: User is not authorized to update categories.
        "404":
          description: Category not found.
    delete:
      summary: Delete a category
      description: Deletes a category by ID. (only mods can access this)
      tags:
        - Categories
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the category to delete.
      responses:
        "200":
          description: Category deleted successfully.
        "400":
          description: Invalid category ID.
        "401":
          description: Missing or invalid authentication token.
        "403":
          description: User is not authorized to delete categories.
        "404":
          description: Category not found.

  /api/items:
    get:
      summary: Get all items
      description: Returns a list of all items available in the marketplace.
      tags:
        - Items
      responses:
        "200":
          description: A list of items.
    post:
      summary: Create a new item
      description: Creates a new item listing. User must be authenticated.
      tags:
        - Items
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - price
                - categoryId
              properties:
                title:
                  type: string
                  example: Used MacBook Pro 13"
                description:
                  type: string
                  example: 2019 model in good condition, includes charger.
                price:
                  type: number
                  example: 650.00
                categoryId:
                  type: integer
                  example: 1
      responses:
        "201":
          description: Item created successfully.
        "400":
          description: Invalid item data.
        "401":
          description: Missing or invalid authentication token.

  /api/items/{id}:
    get:
      summary: Get an item by ID
      description: Returns a single item from its ID.
      tags:
        - Items
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the item to get.
      responses:
        "200":
          description: Item found.
        "400":
          description: Invalid item ID.
        "404":
          description: Item not found.
    put:
      summary: Update an existing item
      description: Updates an existing item listing. User must be authenticated (and typically should own the item).
      tags:
        - Items
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the item to update.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: Used MacBook Pro 13
                description:
                  type: string
                  example: Updated description with more details.
                price:
                  type: number
                  example: 625.00
                categoryId:
                  type: integer
                  example: 2
      responses:
        "200":
          description: Item updated successfully.
        "400":
          description: Invalid request data or item ID.
        "401":
          description: Missing or invalid authentication token.
        "403":
          description: User is not authorized to update this item.
        "404":
          description: Item not found.
    delete:
      summary: Delete an item
      description: Deletes an item by ID. User must be authenticated (and typically should own the item).
      tags:
        - Items
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the item to delete.
      responses:
        "200":
          description: Item deleted successfully.
        "400":
          description: Invalid item ID.
        "401":
          description: Missing or invalid authentication token.
        "403":
          description: User is not authorized to delete this item.
        "404":
          description: Item not found.

  /api/items/{id}/reviews:
    get:
      summary: Get reviews for an item
      description: Returns all reviews associated with a specific item.
      tags:
        - Items
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the item whose reviews will be fetched.
      responses:
        "200":
          description: A list of reviews for the item.
        "400":
          description: Invalid item ID.
        "404":
          description: Item not found or none available.

  /api/orders/orders:
    get:
      summary: Get all orders for the authenticated user
      description: Returns a list of orders that belong to the currently authenticated user.
      tags:
        - Orders
      security:
        - bearerAuth: []
      responses:
        "200":
          description: A list of orders for the user.
        "401":
          description: Missing or invalid authentication token.
    post:
      summary: Create a new order
      description: Creates a new order for the authenticated user.
      tags:
        - Orders
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - items
              properties:
                items:
                  type: array
                  description: List of items and quantities to include in the order.
                  items:
                    type: object
                    required:
                      - itemId
                      - quantity
                    properties:
                      itemId:
                        type: integer
                        example: 3
                      quantity:
                        type: integer
                        example: 2
      responses:
        "201":
          description: Order created successfully.
        "400":
          description: Invalid order data.
        "401":
          description: Missing or invalid authentication token.

  /api/orders/orders/{id}:
    get:
      summary: Get a specific order by ID
      description: Returns details for a single order.
      tags:
        - Orders
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the order to retrieve.
      responses:
        "200":
          description: Order found.
        "400":
          description: Invalid order ID.
        "401":
          description: Missing or invalid authentication token.
        "404":
          description: Order not found.
    delete:
      summary: Delete an order
      description: Deletes an order by ID. Typically restricted based on business rules (e.g., only before processing).
      tags:
        - Orders
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the order to delete.
      responses:
        "200":
          description: Order deleted successfully.
        "400":
          description: Invalid order ID.
        "401":
          description: Missing or invalid authentication token.
        "404":
          description: Order not found.

  /api/orders/orders/{id}/status:
    patch:
      summary: Update the status of an order
      description: Updates the status field of an order (for example, from 'pending' to 'shipped').
      tags:
        - Orders
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the order whose status is being updated.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  example: shipped
      responses:
        "200":
          description: Order status updated successfully.
        "400":
          description: Invalid order ID or status value.
        "401":
          description: Missing or invalid authentication token.
        "404":
          description: Order not found.

  /api/reviews/item/{itemId}:
    get:
      summary: Get reviews for an item
      description: Returns all reviews associated with a specific item.
      tags:
        - Reviews
      parameters:
        - in: path
          name: itemId
          required: true
          schema:
            type: integer
          description: ID of the item whose reviews will be fetched.
      responses:
        "200":
          description: A list of reviews for the item.
        "400":
          description: Invalid item ID.
        "404":
          description: Item not found or no reviews available.

  /api/reviews/user/{username}:
    get:
      summary: Get reviews written by a specific user
      description: Returns all reviews created by the given username.
      tags:
        - Reviews
      parameters:
        - in: path
          name: username
          required: true
          schema:
            type: string
          description: Username whose reviews will be fetched.
      responses:
        "200":
          description: A list of reviews written by the user.
        "400":
          description: Invalid username.
        "404":
          description: User not found or no reviews available.

  /api/reviews:
    post:
      summary: Create a new review
      description: Creates a new review for an item. User must be authenticated.
      tags:
        - Reviews
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - itemId
                - rating
              properties:
                itemId:
                  type: integer
                  example: 5
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
                  example: 4
                comment:
                  type: string
                  example: Great quality, would buy again.
      responses:
        "201":
          description: Review created successfully.
        "400":
          description: Invalid review data.
        "401":
          description: Missing or invalid authentication token.

  /api/reviews/{id}:
    patch:
      summary: Update a review
      description: Updates an existing review. User must be authenticated and typically must own the review.
      tags:
        - Reviews
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the review to update.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
                  example: 5
                comment:
                  type: string
                  example: Updating my review after using it longer.
      responses:
        "200":
          description: Review updated successfully.
        "400":
          description: Invalid request data or review ID.
        "401":
          description: Missing or invalid authentication token.
        "403":
          description: User is not authorized to update this review.
        "404":
          description: Review not found.
    delete:
      summary: Delete a review
      description: Deletes a review by ID. User must be authenticated and typically must own the review.
      tags:
        - Reviews
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the review to delete.
      responses:
        "200":
          description: Review deleted successfully.
        "400":
          description: Invalid review ID.
        "401":
          description: Missing or invalid authentication token.
        "403":
          description: User is not authorized to delete this review.
        "404":
          description: Review not found.

  /api/user/users/{id}:
    get:
      summary: Get a user by ID
      description: Returns public profile information for a specific user.
      tags:
        - Users
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the user to retrieve.
      responses:
        "200":
          description: User found.
        "400":
          description: Invalid user ID.
        "404":
          description: User not found.
    patch:
      summary: Update a user profile
      description: Updates user profile details. Typically restricted so that users can only update their own profile, or moderators can update any profile.
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the user to update.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: malikUpdated
                email:
                  type: string
                  example: malik.updated@example.com
      responses:
        "200":
          description: User updated successfully.
        "400":
          description: Invalid request data or user ID.
        "401":
          description: Missing or invalid authentication token.
        "403":
          description: User is not authorized to update this profile.
        "404":
          description: User not found.
    delete:
      summary: Delete a user account
      description: Deletes a user account. This may be restricted to the account owner or moderators.
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the user to delete.
      responses:
        "200":
          description: User deleted successfully.
        "400":
          description: Invalid user ID.
        "401":
          description: Missing or invalid authentication token.
        "403":
          description: User is not authorized to delete this account.
        "404":
          description: User not found.

  /api/user/users/{id}/role:
    patch:
      summary: Update a user's role
      description: Updates the role of a user (e.g., promoting a user to moderator). Only moderators can perform this action.
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the user whose role is being updated.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: string
                  example: MODERATOR
      responses:
        "200":
          description: User role updated successfully.
        "400":
          description: Invalid user ID or role value.
        "401":
          description: Missing or invalid authentication token.
        "403":
          description: User is not authorized to change roles.
        "404":
          description: User not found.

